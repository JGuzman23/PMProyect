<div class="relative combobox-container">

  <label *ngIf="label" class="flex items-center gap-1 text-[10px] font-semibold text-gray-600 mb-1">
    {{ label }}
    <span *ngIf="required" class="text-red-500">*</span>
  </label>

  <button
    type="button"
    (click)="toggle()"
    [class]="label ? 'w-full px-2 py-1.5 text-left border-2 rounded-md bg-white flex justify-between items-center text-xs' : 'inline-flex items-center px-3 py-1.5 text-xs sm:text-sm border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 relative'"
  >
    <span class="truncate">{{ labelText() }}</span>
    <span>â–¾</span>
  </button>

  @if (isOpen()) {
    <div
      [class]="label ? 'absolute z-50 w-full mt-1 bg-white border rounded shadow-lg' : 'absolute z-50 w-72 min-w-[18rem] max-w-md mt-1 bg-white border rounded shadow-lg right-0'"
      (click)="$event.stopPropagation()"
    >

      @if (searchable) {
        <div class="p-2 border-b">
          <input
            type="text"
            [value]="search()"
            (input)="search.set($any($event.target).value)"
            class="w-full px-2 py-1 text-xs border rounded"
            placeholder="Buscar..."
          />
        </div>
      }

      <div class="max-h-48 overflow-y-auto">
        @for (item of filteredItems(); track item) {
          <div
            (click)="select(item)"
            class="px-2 py-1.5 text-xs cursor-pointer
                   hover:bg-gray-50 flex items-center gap-2"
          >
            @if (multiple) {
              <input type="checkbox" [checked]="isSelected(item)" readonly />
            }
            {{ display(item) }}
          </div>
        }

        @if (filteredItems().length === 0) {
          <div class="p-2 text-xs text-gray-400 text-center">
            Sin resultados
          </div>
        }
      </div>
    </div>
  }
</div>
